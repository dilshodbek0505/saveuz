{% extends "admin/base_site.html" %}
{% load i18n admin_urls static jazzmin rest_framework %}

{% block extrastyle %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'vendor/select2/css/select2.min.css' %}">
{% endblock %}

{% block extrahead %}
    {{ block.super }}
    {{ media }}
{% endblock %}

{% block coltype %}colM{% endblock %}

{% block bodyclass %}{{ block.super }} app-{{ opts.app_label }} model-{{ opts.model_name }} add-form{% endblock %}

{% if not is_popup %}
    {% block breadcrumbs %}
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'admin:index' %}">{% trans 'Home' %}</a></li>
            <li class="breadcrumb-item"><a href="{% url 'admin:app_list' app_label=opts.app_label %}">{{ opts.app_config.verbose_name }}</a></li>
            <li class="breadcrumb-item">
                {% if has_view_permission %}
                    <a href="{% url opts|admin_urlname:'changelist' %}">{{ opts.verbose_name_plural|capfirst }}</a>
                {% else %}
                    {{ opts.verbose_name_plural|capfirst }}
                {% endif %}
            </li>
            <li class="breadcrumb-item active">
                {% blocktrans with name=opts.verbose_name_plural %}Bulk add {{ name }}{% endblocktrans %}
            </li>
        </ol>
    {% endblock %}
{% endif %}

{% block content_title %}{{ title }}{% endblock %}

{% block content %}
    <div id="content-main" class="col-12">
        <form action="{{ form_url }}" method="post" {% if has_file_field %}enctype="multipart/form-data"{% endif %} novalidate>
            {% csrf_token %}
            {{ formset.management_form }}

            {% if formset.non_form_errors %}
                <div class="alert alert-danger">
                    {% for error in formset.non_form_errors %}
                        <p class="mb-0">{{ error }}</p>
                    {% endfor %}
                </div>
            {% endif %}

            {% if errors %}
                <div class="alert alert-danger">
                    {% blocktrans %}Please correct the errors below.{% endblocktrans %}
                </div>
            {% endif %}

            <div class="row">
                <div class="col-12 col-lg-9">
                    {% for form in formset.forms %}
                        <div class="card mb-3">
                            <div class="card-header">
                                <h3 class="card-title mb-0">
                                    {% blocktrans %}Product {{ forloop.counter }}{% endblocktrans %}
                                </h3>
                            </div>
                            <div class="card-body">
                                {% if form.non_field_errors %}
                                    <div class="alert alert-danger">
                                        {% for error in form.non_field_errors %}
                                            <p class="mb-0">{{ error }}</p>
                                        {% endfor %}
                                    </div>
                                {% endif %}

                                {% for field in form.visible_fields %}
                                    <div class="form-group">
                                        <label class="form-label{% if field.field.required %} required{% endif %}" for="{{ field.id_for_label }}">
                                            {{ field.label }}
                                        </label>
                                        {% if field.field.widget.input_type == 'select' %}
                                            {{ field|add_class:"form-select" }}
                                        {% elif field.field.widget.input_type == 'textarea' %}
                                            {{ field|add_class:"form-control" }}
                                        {% elif field.field.widget.input_type == 'file' %}
                                            {{ field|add_class:"form-control-file" }}
                                        {% elif field.field.widget.input_type == 'checkbox' %}
                                            <div class="form-check">
                                                {{ field|add_class:"form-check-input" }}
                                                <label class="form-check-label" for="{{ field.id_for_label }}">{{ field.label }}</label>
                                            </div>
                                        {% else %}
                                            {{ field|add_class:"form-control" }}
                                        {% endif %}
                                        {% if field.help_text %}
                                            <small class="form-text text-muted">{{ field.help_text }}</small>
                                        {% endif %}
                                        {% if field.errors %}
                                            <div class="invalid-feedback d-block">
                                                {% for error in field.errors %}
                                                    <p class="mb-0">{{ error }}</p>
                                                {% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                {% endfor %}

                                {% for hidden in form.hidden_fields %}
                                    {{ hidden }}
                                {% endfor %}
                            </div>
                        </div>
                    {% endfor %}
                </div>

                <div class="col-12 col-lg-3">
                    <div id="jazzy-actions" class="card">
                        <div class="card-body d-flex flex-column">
                            <button type="submit" class="btn btn-success btn-block mb-2">
                                <i class="fas fa-save mr-2"></i>{% trans "Save" %}
                            </button>
                            <a class="btn btn-secondary btn-block mb-2" href="{% url opts|admin_urlname:'changelist' %}">
                                <i class="fas fa-times mr-2"></i>{% trans "Cancel" %}
                            </a>
                            <a class="btn btn-outline-primary btn-block" href="?_single=1">
                                <i class="fas fa-edit mr-2"></i>{% trans "Switch to single add view" %}
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>
{% endblock %}

{% block extrajs %}
    {{ block.super }}
    <script type="text/javascript" src="{% static 'vendor/select2/js/select2.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'jazzmin/js/change_form.js' %}"></script>
{% endblock %}
